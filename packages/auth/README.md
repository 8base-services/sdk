# 8base Auth 

The 8base Auth package contains provider with authentication state and auth helpers.

## AuthProvider

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [AuthProvider](#authprovider)
-   [AuthContextProps](#authcontextprops)
    -   [Properties](#properties)
-   [withAuth](#withauth)
    -   [Parameters](#parameters)

### AuthProvider

**Extends Component**

Provides access to the authentication state.

### AuthContextProps

Authentication context

#### Properties

-   `isAuthorized` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** 
-   `authState` **AuthState?** 
-   `setAuthState` **function (AuthState): void?** 

### withAuth

Hoc to pass auth state to the component

#### Parameters

-   `WrappedComponent` **React$ComponentType&lt;any>** 
-   `auth` **[AuthContextProps](#authcontextprops)** Auth state passed by the props.

Returns **React$ComponentType&lt;InputProps>** 

## Usage

### Simple Usage

```js
import { AuthProvider, AuthConsumer } from '@8base/auth';

  <AuthProvider>
    ...
      <AuthConsumer>
        {
          (auth: AuthContextProps) => (<div />)
        }
      </AuthConsumer>
    ...  
  </AuthProvider>
```

### Usage with @8base/create-apollo-client, @8base/apollo-links and @8base/apollo-provider

```js
import React, { Component } from 'react';
import { BatchHttpLink } from 'apollo-link-batch-http';
import { withAuth } from '@8base/auth';
import { createApolloClient } from '@8base/create-apollo-client';
import { ApolloProvider } from '@8base/apollo-provider';
import { createAuthLink,  fileUploadLink } from '@8base/apollo-links';

withAuth(
  class extends Component {
    getClient: Function;

    constructor(props: AsyncApolloProviderProps) {
      super(props);

      this.getClient = createApolloClient({
        links: [
          fileUploadLink,
          createAuthLink({
            getAuthState: this.getAuthState,
            getRefreshTokenParameters: this.getRefreshTokenParameters,
            onAuthSuccess: this.onAuthSuccess,
            onAuthError: this.onAuthError,
          }),
          new BatchHttpLink({ uri: process.env.REACT_APP_SERVER_URL }),
        ],
      });
    }

    getRefreshTokenParameters = () => {
      const { auth: { authState: { email, refreshToken }}} = this.props;

      return { email, refreshToken };
    }

    onAuthSuccess = ({ refreshToken, idToken }) => {
      const { auth: { setAuthState }} = this.props;

      setAuthState({
        idToken,
        refreshToken,
      });
    }

    onAuthError = (err) => {
      const { auth: { setAuthState }} = this.props;

      setAuthState({
        idToken: '',
        refreshToken: '',
      });
    }

    getAuthState = () => {
      const { auth: { authState: { idToken, organizationId, accountId }}} = this.props;

      return {
        idToken,
        organizationId,
        accountId,
      };
    }

    render() {
      const { children } = this.props;

      return (
        <ApolloProvider
          getClient={ this.getClient }
          uri={ process.env.REACT_APP_SERVER_URL }
        >
          { ({ apolloClient, isLoading }) => (<div />) }
        </ApolloProvider>
      );
    }
  }
)
```
